# セキュリティに関する考慮事項

## 実装済みのセキュリティ対策

### 認証とパスワードセキュリティ
- **パスワードハッシュ化**: bcryptjsを使用し、10ラウンドでパスワードをハッシュ化
- **JWT トークン**: JSON Web Tokenを使用した認証
  - 有効期限: 1週間
  - httpOnlyクッキーに保存（JavaScriptからアクセス不可）
  - SameSite=Strictでクロスサイトリクエストを制限

### レート制限
- **認証エンドポイントの保護**: express-rate-limitを使用
  - 登録とログインのエンドポイントに適用
  - 15分間に5回までのリクエストに制限
  - ブルートフォース攻撃を防止

### データアクセス制御
- **ユーザー分離**: 各ToDoは特定のユーザーに関連付けられている
- **認証ミドルウェア**: 全てのToDoルートは認証が必要
- **アクセス制限**: ユーザーは自分のToDoのみアクセス可能

### JWT シークレットキー
- **環境変数による設定**: `JWT_SECRET`環境変数で設定可能
- **本番環境チェック**: 本番環境では環境変数が必須
- **開発環境フォールバック**: 開発環境では固定キーを使用（警告付き）

## 既知の制限事項と今後の改善点

### CSRF保護（未実装）
**現状**: クッキーベースの認証を使用しているが、CSRF保護がない

**リスク**: 
- クロスサイトリクエストフォージェリ攻撃のリスク
- 悪意のあるサイトからの不正なリクエストを受ける可能性

**推奨される改善策**:
1. CSRFトークンの実装（csurfなどのミドルウェア使用）
2. 全てのフォームにCSRFトークンを追加
3. POSTリクエストでCSRFトークンを検証

### その他の推奨事項

1. **HTTPS の使用**: 本番環境では必ずHTTPSを使用すること

2. **セッション管理の改善**:
   - トークンのブラックリスト機能
   - リフレッシュトークンの実装

3. **入力検証の強化**:
   - メールアドレスの形式検証
   - ユーザー名の文字制限
   - SQLインジェクション対策（現在はパラメータ化クエリを使用）

4. **監査ログ**:
   - ログイン試行の記録
   - 重要な操作のログ記録

5. **環境変数の管理**:
   - 本番環境では必ず`JWT_SECRET`を設定
   - `.env`ファイルの使用を検討

## 本番環境デプロイ時の注意事項

1. `JWT_SECRET`環境変数を必ず設定してください
2. HTTPSを使用してください
3. データベースファイルのバックアップを定期的に行ってください
4. エラーメッセージで機密情報を漏らさないようにしてください
5. 定期的にnpmパッケージを更新してください

## 脆弱性の報告

セキュリティ上の問題を発見した場合は、公開せずにプロジェクトのメンテナーに直接連絡してください。
