# ToDo管理アプリ

Node.js + Express + EJS + SQLiteで構築されたシンプルなToDo管理Webアプリケーションです。

## 機能

### 認証機能
- ✅ ユーザー登録
- ✅ ログイン / ログアウト
- ✅ JWTトークンによる認証（1週間有効）
- ✅ パスワードの安全なハッシュ化（bcryptjs）

### ToDo管理機能
- ✅ ToDoの作成
- ✅ ToDoの一覧表示
- ✅ ToDoの編集
- ✅ ToDoの削除
- ✅ タイトル、内容、期限、優先度の管理
- ✅ 期限と優先度による自動ソート
- ✅ ユーザーごとのToDo管理（他のユーザーのToDoは表示されません）

## 技術スタック

- **バックエンド**: Node.js, Express
- **認証**: JWT (jsonwebtoken), bcryptjs
- **セキュリティ**: express-rate-limit, httpOnly cookies
- **ビューエンジン**: EJS
- **データベース**: SQLite3
- **スタイリング**: CSS

## プロジェクト構成

```
/
├── src/
│   ├── app.js              # アプリケーションエントリーポイント
│   ├── routes/             # ルーター
│   │   ├── authRoutes.js   # 認証ルート
│   │   └── todoRoutes.js   # ToDoルート
│   ├── controllers/        # 業務ロジック（クラスで実装）
│   │   ├── AuthController.js   # 認証コントローラー
│   │   └── TodoController.js   # ToDoコントローラー
│   ├── middleware/         # ミドルウェア
│   │   └── authMiddleware.js   # 認証ミドルウェア
│   ├── views/              # EJSビュー
│   │   ├── index.ejs       # ToDoリスト
│   │   ├── new.ejs         # 新規作成フォーム
│   │   ├── edit.ejs        # 編集フォーム
│   │   ├── login.ejs       # ログイン画面
│   │   └── register.ejs    # ユーザー登録画面
│   └── public/             # 静的コンテンツ
│       └── css/
│           └── style.css
├── data/
│   └── init-db.js          # データベース初期化スクリプト
├── SECURITY.md             # セキュリティに関する文書
└── package.json
```

## セットアップ

### 1. 依存関係のインストール

```bash
npm install
```

### 2. データベースの初期化

```bash
npm run init-db
```

### 3. 環境変数の設定（本番環境のみ）

本番環境では、JWT秘密鍵を環境変数で設定してください：

```bash
export JWT_SECRET="your-secure-random-secret-key"
```

開発環境では自動的にフォールバック値が使用されます（警告メッセージが表示されます）。

### 4. アプリケーションの起動

```bash
npm start
```

アプリケーションは `http://localhost:3000` でアクセスできます。

## 使用方法

### 初回利用時

1. **ユーザー登録**: トップページから「新規登録」をクリックし、ユーザー名、メールアドレス、パスワードを入力
2. **ログイン**: 登録後、ユーザー名とパスワードでログイン

### ToDo管理

1. **ToDoの作成**: トップページの「新規作成」ボタンをクリック
2. **ToDoの表示**: トップページで自分のToDoを確認
3. **ToDoの編集**: 各ToDoの「編集」ボタンをクリック
4. **ToDoの削除**: 各ToDoの「削除」ボタンをクリック（確認ダイアログが表示されます）
5. **ログアウト**: ヘッダーの「ログアウト」ボタンをクリック

## データモデル

### ユーザー (users)

- **ID** (自動生成)
- **ユーザー名** (必須、一意)
- **メールアドレス** (必須、一意)
- **パスワードハッシュ** (bcryptでハッシュ化)
- **作成日時** (自動設定)
- **更新日時** (自動更新)

### ToDo (todos)

- **ID** (自動生成)
- **ユーザーID** (外部キー、users.idを参照)
- **タイトル** (必須)
- **内容** (任意)
- **期限** (任意)
- **優先度** (低/中/高、デフォルト: 中)
- **作成日時** (自動設定)
- **更新日時** (自動更新)

## セキュリティ

このアプリケーションには以下のセキュリティ対策が実装されています：

- **パスワードハッシュ化**: bcryptjsによる10ラウンドのハッシュ化
- **JWT認証**: httpOnlyクッキーでJWTトークンを保存（1週間有効）
- **レート制限**: 認証エンドポイントに15分間で5回までの制限
- **ユーザーデータ分離**: 各ユーザーは自分のToDoのみアクセス可能
- **HTTPS推奨**: 本番環境ではHTTPSの使用を推奨

詳細については [SECURITY.md](./SECURITY.md) を参照してください。

## ライセンス

ISC
