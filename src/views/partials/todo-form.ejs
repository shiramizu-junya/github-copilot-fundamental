<%#
    ToDo作成・編集フォームコンポーネント
    引数:
    - action: フォームのaction URL
    - todo: (編集時) ToDoオブジェクト
    - priorityLabels: 優先度のラベル
    - submitLabel: 送信ボタンのラベル
    - submitIcon: 送信ボタンのアイコン
-%>
<form action="<%= action %>" method="POST">
    <div class="mb-3">
        <label for="title" class="form-label">
            タイトル <span class="text-danger">*</span>
        </label>
        <input type="text" class="form-control" id="title" name="title"
            value="<%= typeof todo !== 'undefined' && todo ? todo.title : '' %>" required placeholder="タイトルを入力">
    </div>

    <div class="mb-3">
        <label for="content" class="form-label">内容</label>
        <textarea class="form-control" id="content" name="content" rows="4"
            placeholder="内容を入力"><%= typeof todo !== 'undefined' && todo ? (todo.content || '') : '' %></textarea>
    </div>

    <div class="mb-3">
        <label for="due_date" class="form-label">期限</label>
        <input type="date" class="form-control" id="due_date" name="due_date"
            value="<%= typeof todo !== 'undefined' && todo ? (todo.due_date || '') : '' %>">
    </div>

    <div class="mb-4">
        <label for="priority" class="form-label">優先度</label>
        <select class="form-select" id="priority" name="priority">
            <% Object.entries(priorityLabels).forEach(([value, label]) => { %>
                <%
                    let isSelected = false;
                    if (typeof todo !== 'undefined' && todo) {
                        isSelected = String(todo.priority) === value;
                    } else {
                        isSelected = value === '2';
                    }
                %>
                <option value="<%= value %>" <%= isSelected ? 'selected' : '' %>>
                    <%= label %>
                </option>
            <% }); %>
        </select>
    </div>

    <div class="d-grid gap-2 d-md-flex justify-content-md-end">
        <a href="/" class="btn btn-outline-secondary me-md-2">キャンセル</a>
        <button type="submit" class="btn btn-primary">
            <i class="bi bi-<%= submitIcon %> me-1"></i><%= submitLabel %>
        </button>
    </div>
</form>
